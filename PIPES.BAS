Function FOV(COORD1,COORD2)
    DISTANCE = 240
    IF COORD1 = 0 THEN
        FOV = 0
    ELSE
        ANGLE = Atn(COORD1 / (DISTANCE + COORD2))
        FOV = (Tan(ANGLE) * DISTANCE)
    ENDIF
End Function

SUB DRAWDOT
    PIXEL(CENTRE.X+FOV(DOTX,DOTZ),CENTRE.Y+FOV(DOTY,DOTZ)) = PURPLE
END SUB

FUNCTION NEWDIR
    DO
        NEWDIR = FIX(RND()*7)-3
    LOOP UNTIL NEWDIR <> 0 AND ABS(NEWDIR) <> ABS(CURRDIR)
END FUNCTION

SUB MOVEDOT
    IF CURRDIR = -3 THEN
        DOTZ = DOTZ - 1
    ELSEIF CURRDIR = -2 THEN
        DOTY = DOTY - 1
    ELSEIF CURRDIR = -1 THEN
        DOTX = DOTX - 1
    ELSEIF CURRDIR = 1 THEN
        DOTX = DOTX + 1
    ELSEIF CURRDIR = 2 THEN
        DOTY = DOTY + 1
    ELSEIF CURRDIR = 3 THEN
        DOTZ = DOTZ + 1
    ENDIF
END SUB

SUB CHECKBUMP
    IF ABS(DOTX) OR ABS(DOTY) OR ABS(DOTZ) > 199 THEN
        IF CURRDIR = 1 AND DOTX > 199 THEN
            CURRDIR = NEWDIR()
        ELSEIF CURRDIR = 2 AND DOTY > 199 THEN
            CURRDIR = NEWDIR()
        ELSEIF CURRDIR = 3 AND DOTZ > 199 THEN
            CURRDIR = NEWDIR()
        ELSEIF CURRDIR = -1 AND DOTX < -199 THEN
            CURRDIR = NEWDIR()
        ELSEIF CURRDIR = -2 AND DOTY < -199 THEN
            CURRDIR = NEWDIR()
        ELSEIF CURRDIR = -3 AND DOTZ < -199 THEN
            CURRDIR = NEWDIR()
        ENDIF
    ENDIF
END SUB

CENTRE.X = (MM.HRES/2)
CENTRE.Y = (MM.VRES/2)
DOTX = 0
DOTY = 0
DOTZ = 0
CURRDIR = 1
CLS
DO
    IF RND() < 0.05 THEN
        CURRDIR = NEWDIR()
    ENDIF
    CHECKBUMP
    MOVEDOT
    DRAWDOT
    PRINT @(0,0) DOTX
    PRINT DOTY
    PRINT DOTZ
    PRINT CURRDIR
LOOP
