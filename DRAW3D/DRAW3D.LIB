
'cats'
FUNCTION TYPECAST(BYTES$)
       FOR J = 0 TO 3
              POKE VAR TYPECAST,J,PEEK(VAR BYTES$,J+1)
       NEXT
END FUNCTION

FUNCTION TYPECAST$(INTEGER)
        TYPECAST$ = "    "
        FOR J = 0 TO 3
                 POKE VAR TYPECAST$,J+1,PEEK(VAR INTEGER,J)
        NEXT
END FUNCTION

SUB LINEREAD(INLINE$,a$,b$,c$,d$)
       v = 1
       g = 1
       DO WHILE v < LEN(INLINE$)
            FOR i = 0 TO 3
                IF MID$(INLINE$,v,1) = "/" OR MID$(INLINE$,v,1) = " " THEN
                    IF i = 0 THEN
                        a$ = MID$(INLINE$,g,v-g)
                    ELSEIF i = 1 THEN
                        b$ = MID$(INLINE$,g,v-g)
                    ELSEIF i = 2 THEN
                        c$ = MID$(INLINE$,g,v-g)
                    ELSEIF i = 3 THEN
                        d$ = MID$(INLINE$,g,v-g)
                    ENDIF
                    IF MID$(INLINE$,v,1) = "/" THEN            
                        DO WHILE MID$(INLINE$,v,1) <> " " AND MID$(INLINE$,v,1) <> ""
                            v = v + 1
                            g = g + 1
                        LOOP
                    ENDIF
                    IF MID$(INLINE$,v,1) = " " THEN
                        DO WHILE MID$(INLINE$,v,1) = " "
                            v = v + 1
                            g = g + 1
                        LOOP
                    ENDIF
                ENDIF
                v = v + 1
            NEXT
       LOOP
END SUB

SUB BINFORMAT
    HEADER = 32
    POINTS = 0
       LINES = -1
    Input "ENTER .OBJ FILE: ",FILENAME$
    Open FILENAME$ For INPUT As #3
    OUTPUT$ = LEFT$(FILENAME$,LEN(FILENAME$)-4)+".BIN"
    DO 
        Line Input #3,LINES$
            LINEREAD(LINES$,t$,x$,y$,z$)
            IF t$ = "v" THEN
                   POINTS = POINTS + 1
            ENDIF
            IF t$ = "f" OR t$ = "l" THEN
                IF z$ <> "" THEN
                    LINES = LINES + 2
                ELSE
                    LINES = LINES + 1
                ENDIF
            ENDIF
            PRINT t$; x$ ;y$ ;z$
    LOOP UNTIL EOF(#3) <> 0
    PRINT POINTS
       PRINT LINES
    CLOSE #3
END SUB

Sub ROTATE(DIR$)
    INCRE = 15
    For i = 0 To POINTS - 1
        If DIR$ = "ZMINUS" Then
            x = (POINTS(i, 0) * Cos(Rad(INCRE))) - (POINTS(i, 1) * Sin(Rad(INCRE)))
            y = (POINTS(i, 0) * Sin(Rad(INCRE))) + (POINTS(i, 1) * Cos(Rad(INCRE)))
            POINTS(i, 0) = x
            POINTS(i, 1) = y
        ElseIf DIR$ = "ZPLUS" Then
            x = (POINTS(i, 0) * Cos(Rad(-INCRE))) - (POINTS(i, 1) * Sin(Rad(-INCRE)))
            y = (POINTS(i, 0) * Sin(Rad(-INCRE))) + (POINTS(i, 1) * Cos(Rad(-INCRE)))
            POINTS(i, 0) = x
            POINTS(i, 1) = y
        ElseIf DIR$ = "XMINUS" Then
            y = (POINTS(i, 1) * Cos(Rad(INCRE))) - (POINTS(i, 2) * Sin(Rad(INCRE)))
            z = (POINTS(i, 1) * Sin(Rad(INCRE))) + (POINTS(i, 2) * Cos(Rad(INCRE)))
            POINTS(i, 1) = y
            POINTS(i, 2) = z
        ElseIf DIR$ = "XPLUS" Then
            y = (POINTS(i, 1) * Cos(Rad(-INCRE))) - (POINTS(i, 2) * Sin(Rad(-INCRE)))
            z = (POINTS(i, 1) * Sin(Rad(-INCRE))) + (POINTS(i, 2) * Cos(Rad(-INCRE)))
            POINTS(i, 1) = y
            POINTS(i, 2) = z
        ElseIf DIR$ = "YMINUS" Then
            x = (POINTS(i, 0) * Cos(Rad(INCRE))) - (POINTS(i, 2) * Sin(Rad(INCRE)))
            z = (POINTS(i, 0) * Sin(Rad(INCRE))) + (POINTS(i, 2) * Cos(Rad(INCRE)))
            POINTS(i, 0) = x
            POINTS(i, 2) = z
        ElseIf DIR$ = "YPLUS" Then
            x = (POINTS(i, 0) * Cos(Rad(-INCRE))) - (POINTS(i, 2) * Sin(Rad(-INCRE)))
            z = (POINTS(i, 0) * Sin(Rad(-INCRE))) + (POINTS(i, 2) * Cos(Rad(-INCRE)))
            POINTS(i, 0) = x
            POINTS(i, 2) = z
        EndIf
    Next
End Sub

SUB COMPRESS
    j = 0
    i = 0
    HEADER = 32
    POINTS = 0
    Input "ENTER .OBJ FILE: ",FILENAME$
    Open FILENAME$ For INPUT As #3
'    OUTPUT$ = LEFT$(FILENAME$,LEN(FILENAME$)-4)+".BIN"
'    OPEN OUTPUT$ FOR RANDOM AS #4
'    SEEK #4, 1
'    PRINT #4,SPACE$(HEADER);
    DO 
        InLine$ = ""
        Line Input #3,INLINE$
        IF LEFT$(INLINE$,2) = "v " OR LEFT$(INLINE$,2) = "f " OR LEFT$(INLINE$,2) = "l "  THEN
            i = 2
            DO WHILE MID$(INLINE$,i,1) <> ""
                InData$ = SPACE$(12)
                j = 1
                DO WHILE MID$(INLINE$,i,1) <> " " AND MID$(INLINE$,i,1) <> "" AND j < 12
                    POKE VAR InData$,j,PEEK(VAR INLINE$,i)
                    i = i + 1
                    j = j + 1
                LOOP
                i = i + 1
                POKE VAR InData$,0,j
                IF INDATA$ <> " " THEN
                    INDATA$ = TYPECAST$(VAL(InData$))
                    PRINT #4,INDATA$;
                                   IF LEFT$(INLINE$,2) = "f " OR LEFT$(INLINE$,2) = "l "  THEN
                                          LINES = LINES + 1
                                   ENDIF
                ENDIF
            LOOP
            IF LEFT$(INLINE$,2) = "v " THEN
                POINTS = POINTS + 1
            ENDIF
        ENDIF
    LOOP UNTIL EOF(#3) <> 0
    INDATA$ = TYPECAST$(POINTS)
'    SEEK #4, 1
'    PRINT #4,INDATA$;
    CLOSE #3
'    CLOSE #4
END SUB

SUB BINPREVIEW
    HEADER = 32
    INPUT FILENAME$
    OPEN FILENAME$ FOR INPUT AS #5
    WORD$ = INPUT$(HEADER, #5)
    COUNT = TYPECAST(WORD$)
    PRINT COUNT
    FOR m = 0  TO COUNT
        FOR l = 0 TO 2
            WORD$ = INPUT$(4, #5)
            NUMBER = TYPECAST(WORD$)
            PRINT NUMBER ;
        NEXT
        PRINT ""
    NEXT
    CLOSE #5
END SUB

SUB REFORMAT
    Input "ENTER .OBJ FILE: ",FILENAME$
    Open FILENAME$ For INPUT As #3
    OPEN "OUTPUT.TMP" FOR OUTPUT AS #4
    DO 
        Line Input #3,INLINE$
        IF LEFT$(INLINE$,2)="v " OR LEFT$(INLINE$,2)="f " OR LEFT$(INLINE$,2)="l " THEN 
            IF LEFT$(INLINE$,2)="v " THEN
                POINTS = POINTS + 1
            ENDIF
            FOR i = 1 TO LEN(INLINE$)
                IF  MID$(INLINE$,i,1) = "/" THEN
                    DO 
                        i = i + 1
                    LOOP UNTIL MID$(INLINE$,i,1) = " " OR MID$(INLINE$,i) = ""
                ENDIF
                IF MID$(INLINE$,i,1) = " " THEN
                    DO 
                        i = i + 1
                    LOOP UNTIL MID$(INLINE$,i,1) <> " " OR MID$(INLINE$,i) = "" 
                    PRINT ",";
                    PRINT #4,",";
                ENDIF
                PRINT #4,MID$(INLINE$,i,1);
                PRINT MID$(INLINE$,i,1);
            NEXT
            PRINT #4,","
            PRINT ","
        ENDIF
    LOOP UNTIL EOF(#3) <> 0
    PRINT #4,POINTS
    PRINT POINTS
    Close #3
    Close #4
END SUB

SUB LOWMEM
    MAGX = 0.2
    ANGLE = 0
    POINTS = 0
    CENTRE.X = MM.HRES/2
    CENTRE.Y = MM.VRES/2
    INPUT FILENAME$
    Open FILENAME$ FOR INPUT AS #4
    WORD$ = INPUT$(4,#4)
    POINTS = TYPECAST(WORD$)
    IGNORE$ = INPUT$(12,#4)
    CLS
    FOR p = 0 TO POINTS
        BYTES$ = INPUT$(4,#4)
        b = TYPECAST(BYTES$)
        BYTES$ = INPUT$(4,#4)
        c = TYPECAST(BYTES$)
        BYTES$ = INPUT$(4,#4)
        d = TYPECAST(BYTES$)
        b = b * MAGX
        c = c * MAGX
        d = d * MAGX
        PRINT @(0,0) b c d
'        y=(c*Cos(Rad(-INCRE)))-(d*Sin(Rad(-INCRE)))
'        z=(c*Sin(Rad(-INCRE)))+(d*Cos(Rad(-INCRE)))
'        x=(b*Cos(Rad(135)))-(d*Sin(Rad(135)))
'        z=(b*Sin(Rad(135)))+(d*Cos(Rad(135)))
        b = b - 100
        c = c - 100
'        d = z - 100
        ANGLE=DEG(ATN(b/(240+d)))
        b = (TAN(RAD(ANGLE))*240)
        ANGLE=DEG(ATN(c/(240+d)))
        c = (TAN(RAD(ANGLE))*240)
        PIXEL(CENTRE.X+b,CENTRE.Y-c)=7
    NEXT
    CLOSE #4
END SUB

SUB PROCVERTEX
    POINTS = 362
    MEMMAX = 1024
    Open "OUTPUT.TMP" For INPUT As #3
    IF POINTS > MEMMAX THEN
        POINTS = MEMMAX
    ENDIF
    DIM POINTS(POINTS,3)
    LOCAL i = 0
    DO WHILE i < POINTS AND EOF(#3) = 0
        INPUT #3, a$,x,y,z
        IF a$ = "v" THEN
                POINTS(i,0) = x
                POINTS(i,1) = y
                POINTS(i,2) = z
                i = i + 1
        ENDIF
    LOOP
    CLOSE #3
END SUB

SUB DRAWLINE
    XOFFSET = 0
    YOFFSET = 0
    ZOFFSET = 0
    MAGX = 0.2
    ANGLE = 0
    POINTS = 362
    CENTRE.X = MM.HRES/2
    CENTRE.Y = MM.VRES/2
    CLS
    FOR i = 0 TO POINTS - 1
        b = POINTS(i,0) * MAGX
        c = POINTS(i,1) * MAGX
        d = POINTS(i,2) * MAGX
        ANGLE=DEG(ATN(b+XOFFSET/(240+d+ZOFFSET)))
        b = (TAN(RAD(ANGLE))*240)
        ANGLE=DEG(ATN(c+YOFFSET/(240+d+ZOFFSET)))
        c = (TAN(RAD(ANGLE))*240)
        PIXEL(CENTRE.X+b,CENTRE.Y-c)=7
    NEXT
END SUB

Sub KEYPRESS
    KEYPRESS$ = InKey$
    If KEYPRESS$ <> "" Then
        If KEYPRESS$ = "q" Then
            ROTATE("ZMINUS")
            DRAWLINE
        ElseIf KEYPRESS$ = "e" Then
            ROTATE("ZPLUS")
            DRAWLINE
        ElseIf KEYPRESS$ = "w" Then
            ROTATE("XMINUS")
            DRAWLINE
        ElseIf KEYPRESS$ = "s" Then
            ROTATE("XPLUS")
            DRAWLINE
        ElseIf KEYPRESS$ = "a" Then
            ROTATE("YMINUS")
            DRAWLINE
        ElseIf KEYPRESS$ = "d" Then
            ROTATE("YPLUS")
            DRAWLINE
        EndIf
    EndIf
End Sub
    
'REFORMAT
'PROCVERTEX
'DRAWLINE
'KILL "OUTPUT.TMP"
'END
                  